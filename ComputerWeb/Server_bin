#include <fstream>
#include <iostream>
#include <thread>
#include <chrono>
#include <vector>

using namespace std;

string filename = "C:\\Users\\Admin\\source\\repos\\data.bin";  // Путь к бинарному файлу

vector<int> readNumbersFromFile(const string& filename) {
    ifstream file(filename, ios::binary);
    vector<int> numbers;

    if (!file) {
        cout << "Ошибка открытия бинарного файла!" << endl;
        return numbers;
    }

    while (!file.eof()) {
        size_t size;
        file.read(reinterpret_cast<char*>(&size), sizeof(size_t));
        if (file.eof()) break;

        vector<int> block(size);
        file.read(reinterpret_cast<char*>(block.data()), sizeof(int) * size);
        numbers.insert(numbers.end(), block.begin(), block.end());
    }

    file.close();
    return numbers;
}

double calculateAverage(const vector<int>& numbers) {
    if (numbers.empty()) return 0.0;
    double sum = 0;
    for (int num : numbers) sum += num;
    return sum / numbers.size();
}

int main() {
    setlocale(LC_ALL, "rus");

    cout << "Сервер запущен и следит за изменением файла..." << endl;

    while (true) {
        this_thread::sleep_for(chrono::seconds(5));  // Проверка каждые 5 секунд

        vector<int> numbers = readNumbersFromFile(filename);
        if (numbers.empty()) {
            continue;  // Если нет данных, продолжаем ждать
        }

        cout << "\nФайл обновлён!" << endl;
        double avg = calculateAverage(numbers);
        cout << "Средний балл: " << avg << endl;

        if (avg > 4.5) {
            cout << "Студент получает стипендию!" << endl;
        }
        else {
            cout << "Стипендия не положена." << endl;
        }
    }

    return 0;
}